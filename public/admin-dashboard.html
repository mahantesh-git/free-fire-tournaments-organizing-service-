<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Free Fire Tournament</title>
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Orbitron:wght@400;700;900&display=swap"
        rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }

        .stat-card-large {
            background: linear-gradient(135deg, var(--color-bg-card), var(--color-bg-secondary));
            border: var(--border-width-thin) solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--space-6);
            position: relative;
            overflow: hidden;
            transition: all var(--transition-base);
        }

        .stat-card-large:hover {
            border-color: var(--color-border-hover);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow);
        }

        .stat-card-large::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, var(--color-primary) 0%, transparent 70%);
            opacity: 0.1;
        }

        .stat-icon {
            font-size: var(--font-size-4xl);
            margin-bottom: var(--space-3);
        }

        .stat-number {
            font-size: var(--font-size-4xl);
            font-weight: var(--font-weight-black);
            font-family: var(--font-heading);
            color: var(--color-primary);
            margin-bottom: var(--space-2);
        }

        .stat-description {
            color: var(--color-text-muted);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-4);
        }

        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-6);
            background: var(--color-bg-card);
            border: var(--border-width-thin) solid var(--color-border);
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            color: var(--color-text-primary);
        }

        .action-btn:hover {
            border-color: var(--color-primary);
            background: var(--color-bg-tertiary);
            transform: translateY(-2px);
        }

        .action-icon {
            font-size: var(--font-size-3xl);
        }

        .action-label {
            font-weight: var(--font-weight-semibold);
            text-align: center;
        }

        .recent-activity {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-4);
            border-bottom: var(--border-width-thin) solid var(--color-border);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-bg-secondary);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-xl);
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-1);
        }

        .activity-time {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="container flex justify-between items-center">
            <a href="/" class="navbar-brand">FF TOURNAMENT</a>
            <nav>
                <ul class="navbar-nav">
                    <li><a href="/" class="navbar-link">Home</a></li>
                    <li><a href="/scoreboard-realtime" class="navbar-link">Scoreboard</a></li>
                    <li><a href="/registration-modern" class="navbar-link">Registration</a></li>
                    <li><a href="/admin-dashboard" class="navbar-link"
                            style="color: var(--color-primary);">Dashboard</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="container" style="padding-top: var(--space-8); padding-bottom: var(--space-8);">
        <!-- Header -->
        <div class="flex justify-between items-center animate-fadeIn" style="margin-bottom: var(--space-8);">
            <div>
                <h1
                    style="font-family: var(--font-heading); color: var(--color-primary); margin-bottom: var(--space-2);">
                    ADMIN DASHBOARD
                </h1>
                <p class="text-muted">Tournament Management & Analytics</p>
            </div>
            <div class="badge badge-success">
                <span
                    style="width: 8px; height: 8px; background: white; border-radius: 50%; display: inline-block; margin-right: 8px;"></span>
                System Active
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="dashboard-grid animate-fadeIn" style="animation-delay: 0.1s;">
            <div class="stat-card-large">
                <div class="stat-icon">üë•</div>
                <div class="stat-number" id="totalPlayers">0</div>
                <div class="stat-description">Total Players</div>
            </div>

            <div class="stat-card-large">
                <div class="stat-icon">üéØ</div>
                <div class="stat-number" id="totalKills">0</div>
                <div class="stat-description">Total Kills</div>
            </div>

            <div class="stat-card-large">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-number" id="activeGames">0</div>
                <div class="stat-description">Active Games</div>
            </div>

            <div class="stat-card-large">
                <div class="stat-icon">üìä</div>
                <div class="stat-number" id="avgKills">0</div>
                <div class="stat-description">Avg Kills/Player</div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-8">
            <!-- Quick Actions -->
            <div class="card animate-fadeIn" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <h2 class="card-title">Quick Actions</h2>
                </div>
                <div class="card-body">
                    <div class="quick-actions">
                        <a href="/registration-modern" class="action-btn">
                            <div class="action-icon">‚ûï</div>
                            <div class="action-label">Add Player</div>
                        </a>

                        <a href="/blueprint" class="action-btn">
                            <div class="action-icon">üèóÔ∏è</div>
                            <div class="action-label">Create Tournament</div>
                        </a>

                        <a href="/scoreboard-realtime" class="action-btn">
                            <div class="action-icon">üì∫</div>
                            <div class="action-label">View Scoreboard</div>
                        </a>

                        <button class="action-btn" onclick="exportAllData()">
                            <div class="action-icon">üì•</div>
                            <div class="action-label">Export Data</div>
                        </button>

                        <button class="action-btn" onclick="clearAllData()">
                            <div class="action-icon">üóëÔ∏è</div>
                            <div class="action-label">Clear Data</div>
                        </button>

                        <button class="action-btn" onclick="refreshStats()">
                            <div class="action-icon">üîÑ</div>
                            <div class="action-label">Refresh Stats</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="card animate-fadeIn" style="animation-delay: 0.3s;">
                <div class="card-header">
                    <h2 class="card-title">Recent Activity</h2>
                </div>
                <div class="card-body">
                    <div class="recent-activity" id="activityList">
                        <div class="text-center" style="padding: var(--space-16);">
                            <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üìã</div>
                            <p class="text-muted">No recent activity</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Players -->
        <div class="card animate-fadeIn" style="margin-top: var(--space-8); animation-delay: 0.4s;">
            <div class="card-header">
                <h2 class="card-title">Top 10 Players</h2>
            </div>
            <div class="card-body">
                <div class="table" style="overflow-x: auto;">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player Name</th>
                                <th>FF ID</th>
                                <th class="text-center">Total Kills</th>
                                <th class="text-center">Bermuda</th>
                                <th class="text-center">Purgatory</th>
                                <th class="text-center">Kalahari</th>
                            </tr>
                        </thead>
                        <tbody id="topPlayersBody">
                            <tr>
                                <td colspan="7" class="text-center" style="padding: var(--space-16);">
                                    <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üèÜ
                                    </div>
                                    <p class="text-muted">No data available</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let activities = [];

        // Socket events
        socket.on('playerAdded', (player) => {
            addActivity('Player Added', `${player.playerName} registered`, '‚ûï');
            loadStats();
        });

        socket.on('playerUpdated', (player) => {
            addActivity('Player Updated', `${player.playerName} information changed`, '‚úèÔ∏è');
            loadStats();
        });

        socket.on('playerDeleted', (playerId) => {
            addActivity('Player Deleted', 'A player was removed', 'üóëÔ∏è');
            loadStats();
        });

        socket.on('playersImported', (players) => {
            addActivity('Bulk Import', `${players.length} players imported`, 'üì§');
            loadStats();
        });

        // Load data on page load
        window.onload = () => {
            loadStats();
            loadTopPlayers();
        };

        async function loadStats() {
            try {
                const [playersRes, killsRes] = await Promise.all([
                    fetch('/api/players'),
                    fetch('/api/kills/getPlayers')
                ]);

                const players = await playersRes.json();
                const killsData = await killsRes.json();

                const totalPlayers = players.length;
                const totalKills = killsData.reduce((sum, p) => sum + (p.total || 0), 0);
                const avgKills = totalPlayers > 0 ? (totalKills / totalPlayers).toFixed(1) : 0;

                document.getElementById('totalPlayers').textContent = totalPlayers;
                document.getElementById('totalKills').textContent = totalKills;
                document.getElementById('avgKills').textContent = avgKills;

                // Active games - placeholder
                document.getElementById('activeGames').textContent = '0';
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        async function loadTopPlayers() {
            try {
                const response = await fetch('/api/kills/getPlayers');
                const players = await response.json();

                // Sort by total kills
                players.sort((a, b) => (b.total || 0) - (a.total || 0));
                const topPlayers = players.slice(0, 10);

                const tbody = document.getElementById('topPlayersBody');

                if (topPlayers.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="text-center" style="padding: var(--space-16);">
                                <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üèÜ</div>
                                <p class="text-muted">No data available</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = topPlayers.map((player, index) => {
                    const rank = index + 1;
                    const medals = ['ü•á', 'ü•à', 'ü•â'];
                    const rankDisplay = rank <= 3 ? medals[rank - 1] : `#${rank}`;

                    return `
                        <tr>
                            <td>
                                <span class="badge ${rank <= 3 ? 'badge-warning' : ''}">
                                    ${rankDisplay}
                                </span>
                            </td>
                            <td class="font-semibold">${player.playerName}</td>
                            <td class="text-muted">${player.ffId || player.ffName}</td>
                            <td class="text-center">
                                <span class="badge badge-success">${player.total || 0}</span>
                            </td>
                            <td class="text-center">${player.map1 || 0}</td>
                            <td class="text-center">${player.map2 || 0}</td>
                            <td class="text-center">${player.map3 || 0}</td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading top players:', error);
            }
        }

        function addActivity(title, description, icon) {
            const activity = {
                title,
                description,
                icon,
                time: new Date().toLocaleTimeString()
            };

            activities.unshift(activity);
            activities = activities.slice(0, 10); // Keep only last 10

            renderActivities();
        }

        function renderActivities() {
            const list = document.getElementById('activityList');

            if (activities.length === 0) {
                list.innerHTML = `
                    <div class="text-center" style="padding: var(--space-16);">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üìã</div>
                        <p class="text-muted">No recent activity</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = activities.map(activity => `
                <div class="activity-item">
                    <div class="activity-icon">${activity.icon}</div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-time">${activity.description} ‚Ä¢ ${activity.time}</div>
                    </div>
                </div>
            `).join('');
        }

        function refreshStats() {
            loadStats();
            loadTopPlayers();
            showNotification('Stats refreshed!', 'success');
        }

        function exportAllData() {
            window.location.href = '/api/players/export';
            showNotification('Exporting data...', 'info');
        }

        async function clearAllData() {
            if (!confirm('Are you sure you want to clear ALL data? This action cannot be undone!')) return;

            showNotification('This feature is not yet implemented', 'warning');
        }

        function showNotification(message, type = 'info') {
            const colors = {
                success: 'var(--color-success)',
                error: 'var(--color-error)',
                warning: 'var(--color-warning)',
                info: 'var(--color-info)'
            };

            const notification = document.createElement('div');
            notification.className = 'badge';
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '80px';
            notification.style.right = '20px';
            notification.style.zIndex = '9999';
            notification.style.padding = 'var(--space-4) var(--space-6)';
            notification.style.fontSize = 'var(--font-size-base)';
            notification.style.boxShadow = 'var(--shadow-xl)';
            notification.style.background = colors[type];

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>