<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Registration - Free Fire Tournament</title>
    <link rel="stylesheet" href="/css/design-system.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Orbitron:wght@400;700;900&display=swap"
        rel="stylesheet">
    <style>
        .form-group {
            margin-bottom: var(--space-6);
        }

        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
            text-transform: uppercase;
            font-size: var(--font-size-sm);
            letter-spacing: 0.05em;
        }

        .form-actions {
            display: flex;
            gap: var(--space-4);
            margin-top: var(--space-8);
        }

        .file-upload {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-upload input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-upload-label {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-6);
            background: var(--color-bg-secondary);
            border: var(--border-width-medium) dashed var(--color-border);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .file-upload-label:hover {
            border-color: var(--color-primary);
            background: var(--color-bg-tertiary);
        }

        .players-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: var(--color-bg-secondary);
            border: var(--border-width-thin) solid var(--color-border);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--space-3);
            transition: all var(--transition-base);
        }

        .player-item:hover {
            border-color: var(--color-border-hover);
            transform: translateX(4px);
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: var(--font-weight-bold);
            color: var(--color-text-primary);
            margin-bottom: var(--space-1);
        }

        .player-details {
            font-size: var(--font-size-sm);
            color: var(--color-text-muted);
        }

        .player-actions {
            display: flex;
            gap: var(--space-2);
        }

        .icon-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius-md);
            border: var(--border-width-thin) solid var(--color-border);
            background: transparent;
            color: var(--color-text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .icon-btn:hover {
            background: var(--color-bg-tertiary);
            border-color: var(--color-primary);
            color: var(--color-primary);
        }

        .icon-btn.delete:hover {
            border-color: var(--color-error);
            color: var(--color-error);
        }

        .search-box {
            position: relative;
            margin-bottom: var(--space-6);
        }

        .search-icon {
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--color-text-muted);
        }

        .search-box input {
            padding-left: calc(var(--space-4) * 3);
        }

        .tab-nav {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            border-bottom: var(--border-width-thin) solid var(--color-border);
        }

        .tab-btn {
            padding: var(--space-3) var(--space-6);
            background: transparent;
            border: none;
            border-bottom: var(--border-width-medium) solid transparent;
            color: var(--color-text-muted);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>

<body>
    <div class="navbar">
        <div class="container flex justify-between items-center">
            <a href="/" class="navbar-brand">FF TOURNAMENT</a>
            <nav>
                <ul class="navbar-nav">
                    <li><a href="/" class="navbar-link">Home</a></li>
                    <li><a href="/scoreboard-realtime" class="navbar-link">Scoreboard</a></li>
                    <li><a href="/playerRegistration" class="navbar-link"
                            style="color: var(--color-primary);">Registration</a></li>
                </ul>
            </nav>
        </div>
    </div>

    <div class="container" style="padding-top: var(--space-8); padding-bottom: var(--space-8);">
        <!-- Header -->
        <div class="text-center animate-fadeIn" style="margin-bottom: var(--space-8);">
            <h1 style="font-family: var(--font-heading); color: var(--color-primary); margin-bottom: var(--space-2);">
                PLAYER REGISTRATION
            </h1>
            <p class="text-muted">Register players individually or import via Excel</p>
        </div>

        <div class="grid grid-cols-2 gap-8">
            <!-- Registration Form -->
            <div class="card animate-fadeIn" style="animation-delay: 0.1s;">
                <div class="card-header">
                    <h2 class="card-title">Add New Player</h2>
                </div>

                <div class="card-body">
                    <!-- Tabs -->
                    <div class="tab-nav">
                        <button class="tab-btn active" onclick="switchTab('manual')">Manual Entry</button>
                        <button class="tab-btn" onclick="switchTab('import')">Import Excel</button>
                    </div>

                    <!-- Manual Entry Tab -->
                    <div id="manual-tab" class="tab-content active">
                        <form id="playerForm">
                            <div class="form-group">
                                <label class="form-label" for="playerName">Player Name *</label>
                                <input type="text" id="playerName" class="input" placeholder="Enter player name"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="phone">Phone Number *</label>
                                <input type="tel" id="phone" class="input" placeholder="Enter phone number" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="ffid">Free Fire ID *</label>
                                <input type="text" id="ffid" class="input" placeholder="Enter FF ID" required>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" style="flex: 1;">
                                    <span>‚ûï</span>
                                    Add Player
                                </button>
                                <button type="reset" class="btn btn-outline">
                                    Clear
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Import Tab -->
                    <div id="import-tab" class="tab-content">
                        <div class="file-upload">
                            <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="handleFileSelect(event)">
                            <label for="excelFile" class="file-upload-label">
                                <span style="font-size: var(--font-size-3xl);">üìÅ</span>
                                <div>
                                    <div class="font-semibold">Choose Excel File</div>
                                    <div class="text-muted" style="font-size: var(--font-size-sm);">
                                        Click to browse or drag and drop
                                    </div>
                                </div>
                            </label>
                        </div>

                        <div id="fileInfo" style="margin-top: var(--space-4); display: none;">
                            <div class="badge badge-success">
                                <span id="fileName"></span>
                            </div>
                        </div>

                        <button id="importBtn" class="btn btn-primary" style="margin-top: var(--space-6); width: 100%;"
                            onclick="importPlayers()" disabled>
                            <span>üì§</span>
                            Import Players
                        </button>

                        <div
                            style="margin-top: var(--space-6); padding: var(--space-4); background: var(--color-bg-secondary); border-radius: var(--border-radius-md);">
                            <p class="text-muted"
                                style="font-size: var(--font-size-sm); margin-bottom: var(--space-2);">
                                <strong>Excel Format:</strong>
                            </p>
                            <p class="text-muted" style="font-size: var(--font-size-sm);">
                                Columns: <code>name</code>, <code>phone</code>, <code>ffid</code>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Players List -->
            <div class="card animate-fadeIn" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <div class="flex justify-between items-center">
                        <h2 class="card-title" style="margin-bottom: 0;">Registered Players</h2>
                        <div class="badge badge-primary" id="playerCount">0</div>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Search -->
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" id="searchInput" class="input" placeholder="Search players..."
                            onkeyup="searchPlayers()">
                    </div>

                    <!-- Players List -->
                    <div class="players-list" id="playersList">
                        <div class="text-center" style="padding: var(--space-16);">
                            <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üë•</div>
                            <p class="text-muted">No players registered yet</p>
                        </div>
                    </div>
                </div>

                <div style="padding: var(--space-4); border-top: var(--border-width-thin) solid var(--color-border);">
                    <button class="btn btn-secondary" style="width: 100%;" onclick="exportPlayers()">
                        <span>üì•</span>
                        Export to Excel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let selectedFile = null;

        // Load players on page load
        window.onload = () => {
            loadPlayers();
        };

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');
        }

        // Load players
        async function loadPlayers() {
            try {
                const response = await fetch('/api/players');
                players = await response.json();
                renderPlayers();
            } catch (error) {
                console.error('Error loading players:', error);
                showNotification('Error loading players', 'error');
            }
        }

        // Render players list
        function renderPlayers(filteredPlayers = null) {
            const list = document.getElementById('playersList');
            const displayPlayers = filteredPlayers || players;

            document.getElementById('playerCount').textContent = displayPlayers.length;

            if (displayPlayers.length === 0) {
                list.innerHTML = `
                    <div class="text-center" style="padding: var(--space-16);">
                        <div style="font-size: var(--font-size-4xl); margin-bottom: var(--space-4);">üë•</div>
                        <p class="text-muted">No players found</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = displayPlayers.map(player => `
                <div class="player-item animate-slideInLeft">
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-details">
                            üìû ${player.phone} ‚Ä¢ üéÆ ${player.ffid}
                        </div>
                    </div>
                    <div class="player-actions">
                        <button class="icon-btn" onclick="editPlayer('${player._id}')" title="Edit">
                            ‚úèÔ∏è
                        </button>
                        <button class="icon-btn delete" onclick="deletePlayer('${player._id}')" title="Delete">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Search players
        function searchPlayers() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = players.filter(p =>
                p.name.toLowerCase().includes(query) ||
                p.phone.includes(query) ||
                p.ffid.toLowerCase().includes(query)
            );
            renderPlayers(filtered);
        }

        // Add player
        document.getElementById('playerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const playerData = {
                name: document.getElementById('playerName').value,
                phone: document.getElementById('phone').value,
                ffid: document.getElementById('ffid').value
            };

            try {
                const response = await fetch('/api/players', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(playerData)
                });

                if (response.ok) {
                    showNotification('Player added successfully!', 'success');
                    document.getElementById('playerForm').reset();
                    loadPlayers();
                } else {
                    showNotification('Error adding player', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error adding player', 'error');
            }
        });

        // Delete player
        async function deletePlayer(id) {
            if (!confirm('Are you sure you want to delete this player?')) return;

            try {
                const response = await fetch(`/api/players/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    showNotification('Player deleted successfully!', 'success');
                    loadPlayers();
                } else {
                    showNotification('Error deleting player', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error deleting player', 'error');
            }
        }

        // File selection
        function handleFileSelect(event) {
            selectedFile = event.target.files[0];
            if (selectedFile) {
                document.getElementById('fileName').textContent = selectedFile.name;
                document.getElementById('fileInfo').style.display = 'block';
                document.getElementById('importBtn').disabled = false;
            }
        }

        // Import players
        async function importPlayers() {
            if (!selectedFile) return;

            const formData = new FormData();
            formData.append('file', selectedFile);

            try {
                const response = await fetch('/api/players/import', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showNotification('Players imported successfully!', 'success');
                    selectedFile = null;
                    document.getElementById('excelFile').value = '';
                    document.getElementById('fileInfo').style.display = 'none';
                    document.getElementById('importBtn').disabled = true;
                    loadPlayers();
                } else {
                    showNotification('Error importing players', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showNotification('Error importing players', 'error');
            }
        }

        // Export players
        function exportPlayers() {
            window.location.href = '/api/players/export';
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `badge badge-${type === 'success' ? 'success' : 'error'}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '9999';
            notification.style.padding = 'var(--space-4) var(--space-6)';
            notification.style.fontSize = 'var(--font-size-base)';
            notification.style.boxShadow = 'var(--shadow-xl)';

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>

</html>